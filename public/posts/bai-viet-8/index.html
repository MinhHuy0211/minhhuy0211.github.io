<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bài 8: Xử lý ngoại lệ (Exception) khi lập trình mạng trong Java - Nguyễn Trịnh Minh Huy</title>

    
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">

    
<link rel="stylesheet" href="https://minhhuy0211.github.io/css/style.css">
</head>
<body>

    
<header class="luxury-header">
    <nav class="luxury-nav">

        
        <div class="luxury-logo">
            <a href="https://minhhuy0211.github.io/">
                NGUYỄN TRỊNH MINH HUY
            </a>
        </div>

        
        <ul class="luxury-menu">
            <li>
                <a href="https://minhhuy0211.github.io/"
                   class="">
                    TRANG CHỦ
                </a>
            </li>

            <li>
                <a href="https://minhhuy0211.github.io/about/"
                   class="">
                    GIỚI THIỆU
                </a>
            </li>

            <li>
                <a href="https://minhhuy0211.github.io/posts/"
                   class="active">
                    BLOG
                </a>
            </li>

            
            <li>
                <a href="https://minhhuy0211.github.io/certificates/"
                   class="">
                    CHỨNG CHỈ
                </a>
            </li>

            <li>
                <a href="https://minhhuy0211.github.io/contact/"
                   class="">
                    LIÊN HỆ
                </a>
            </li>
        </ul>
    </nav>
</header>


    
    <main>
<div class="article-wrapper">
    <article class="main-article">
        <header class="article-header">
            <p class="article-meta">22 JANUARY 2025 — [Java Network Exception Handling Socket Best Practice]</p>
            <h1 class="article-title">Bài 8: Xử lý ngoại lệ (Exception) khi lập trình mạng trong Java</h1>
        </header>
        
        <div class="article-content">
            <p>Lập trình mạng là một trong những lĩnh vực <strong>rủi ro nhất</strong> trong Java. Lý do:</p>
<ul>
<li>Mạng có thể chập chờn (wifi yếu, dây lỏng).</li>
<li>Server có thể tắt đột ngột.</li>
<li>Client gửi dữ liệu sai định dạng.</li>
<li>Firewall chặn port&hellip;</li>
</ul>
<p>Nếu không xử lý ngoại lệ đúng cách, toàn bộ chương trình sẽ <strong>crash ngay lập tức</strong> với stack trace dài dằng dặc – trải nghiệm người dùng cực tệ.</p>
<p>Bài hôm nay sẽ giúp bạn biến chương trình mạng từ &ldquo;dễ chết&rdquo; thành <strong>bền bỉ, chuyên nghiệp</strong> bằng cách xử lý exception một cách thông minh.</p>
<h3 id="1-các-ngoại-lệ-phổ-biến-khi-lập-trình-mạng">1. Các ngoại lệ phổ biến khi lập trình mạng</h3>
<table>
  <thead>
      <tr>
          <th>Ngoại lệ</th>
          <th>Nguyên nhân thường gặp</th>
          <th>Khi nào xảy ra?</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>UnknownHostException</code></td>
          <td>Không tìm thấy hostname/IP</td>
          <td><code>InetAddress.getByName()</code>, kết nối sai IP</td>
      </tr>
      <tr>
          <td><code>ConnectException</code></td>
          <td>Server từ chối kết nối (không có ai lắng nghe)</td>
          <td><code>new Socket(...)</code> khi server chưa chạy</td>
      </tr>
      <tr>
          <td><code>SocketTimeoutException</code></td>
          <td>Timeout khi kết nối hoặc đọc dữ liệu</td>
          <td><code>socket.setSoTimeout()</code></td>
      </tr>
      <tr>
          <td><code>IOException</code></td>
          <td>Lỗi chung I/O (mạng đứt, client đóng đột ngột&hellip;)</td>
          <td>Hầu hết các thao tác socket</td>
      </tr>
      <tr>
          <td><code>SocketException</code></td>
          <td>Socket bị đóng, reset bởi peer</td>
          <td>Client/Server ngắt kết nối bất ngờ</td>
      </tr>
  </tbody>
</table>
<h3 id="2-quy-tắc-vàng-luôn-dùng-try-with-resources-java-7">2. Quy tắc vàng: Luôn dùng try-with-resources (Java 7+)</h3>
<p>Đây là cách <strong>tốt nhất và sạch nhất</strong> để tự động đóng tài nguyên (socket, stream&hellip;) mà không cần viết <code>finally</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">import</span> java.net.*;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.io.*;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SafeClient</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span>(String<span style="color:#f92672">[]</span> args) {
</span></span><span style="display:flex;"><span>        String host <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;localhost&#34;</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> port <span style="color:#f92672">=</span> 8080;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Try-with-resources: tự động đóng socket và các stream</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> (Socket socket <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Socket(host, port);
</span></span><span style="display:flex;"><span>             PrintWriter out <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> PrintWriter(socket.<span style="color:#a6e22e">getOutputStream</span>(), <span style="color:#66d9ef">true</span>);
</span></span><span style="display:flex;"><span>             BufferedReader in <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> BufferedReader(<span style="color:#66d9ef">new</span> InputStreamReader(socket.<span style="color:#a6e22e">getInputStream</span>()))) {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;Kết nối thành công đến &#34;</span> <span style="color:#f92672">+</span> host <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;:&#34;</span> <span style="color:#f92672">+</span> port);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            out.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;Hello Server từ Huy!&#34;</span>);
</span></span><span style="display:flex;"><span>            String response <span style="color:#f92672">=</span> in.<span style="color:#a6e22e">readLine</span>();
</span></span><span style="display:flex;"><span>            System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;Server trả lời: &#34;</span> <span style="color:#f92672">+</span> response);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (UnknownHostException e) {
</span></span><span style="display:flex;"><span>            System.<span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;Không tìm thấy host: &#34;</span> <span style="color:#f92672">+</span> host);
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (ConnectException e) {
</span></span><span style="display:flex;"><span>            System.<span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;Không thể kết nối đến server. Server đang tắt hoặc port sai?&#34;</span>);
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (SocketTimeoutException e) {
</span></span><span style="display:flex;"><span>            System.<span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;Timeout: Server không phản hồi kịp&#34;</span>);
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (IOException e) {
</span></span><span style="display:flex;"><span>            System.<span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;Lỗi I/O: &#34;</span> <span style="color:#f92672">+</span> e.<span style="color:#a6e22e">getMessage</span>());
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// e.printStackTrace(); // Chỉ dùng khi debug</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div>  
        </div>
        <div class="article-content">
            <p>Lập trình mạng là một trong những lĩnh vực <strong>rủi ro nhất</strong> trong Java. Lý do:</p>
<ul>
<li>Mạng có thể chập chờn (wifi yếu, dây lỏng).</li>
<li>Server có thể tắt đột ngột.</li>
<li>Client gửi dữ liệu sai định dạng.</li>
<li>Firewall chặn port&hellip;</li>
</ul>
<p>Nếu không xử lý ngoại lệ đúng cách, toàn bộ chương trình sẽ <strong>crash ngay lập tức</strong> với stack trace dài dằng dặc – trải nghiệm người dùng cực tệ.</p>
<p>Bài hôm nay sẽ giúp bạn biến chương trình mạng từ &ldquo;dễ chết&rdquo; thành <strong>bền bỉ, chuyên nghiệp</strong> bằng cách xử lý exception một cách thông minh.</p>
<h3 id="1-các-ngoại-lệ-phổ-biến-khi-lập-trình-mạng">1. Các ngoại lệ phổ biến khi lập trình mạng</h3>
<table>
  <thead>
      <tr>
          <th>Ngoại lệ</th>
          <th>Nguyên nhân thường gặp</th>
          <th>Khi nào xảy ra?</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>UnknownHostException</code></td>
          <td>Không tìm thấy hostname/IP</td>
          <td><code>InetAddress.getByName()</code>, kết nối sai IP</td>
      </tr>
      <tr>
          <td><code>ConnectException</code></td>
          <td>Server từ chối kết nối (không có ai lắng nghe)</td>
          <td><code>new Socket(...)</code> khi server chưa chạy</td>
      </tr>
      <tr>
          <td><code>SocketTimeoutException</code></td>
          <td>Timeout khi kết nối hoặc đọc dữ liệu</td>
          <td><code>socket.setSoTimeout()</code></td>
      </tr>
      <tr>
          <td><code>IOException</code></td>
          <td>Lỗi chung I/O (mạng đứt, client đóng đột ngột&hellip;)</td>
          <td>Hầu hết các thao tác socket</td>
      </tr>
      <tr>
          <td><code>SocketException</code></td>
          <td>Socket bị đóng, reset bởi peer</td>
          <td>Client/Server ngắt kết nối bất ngờ</td>
      </tr>
  </tbody>
</table>
<h3 id="2-quy-tắc-vàng-luôn-dùng-try-with-resources-java-7">2. Quy tắc vàng: Luôn dùng try-with-resources (Java 7+)</h3>
<p>Đây là cách <strong>tốt nhất và sạch nhất</strong> để tự động đóng tài nguyên (socket, stream&hellip;) mà không cần viết <code>finally</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">import</span> java.net.*;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.io.*;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SafeClient</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span>(String<span style="color:#f92672">[]</span> args) {
</span></span><span style="display:flex;"><span>        String host <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;localhost&#34;</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> port <span style="color:#f92672">=</span> 8080;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Try-with-resources: tự động đóng socket và các stream</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> (Socket socket <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Socket(host, port);
</span></span><span style="display:flex;"><span>             PrintWriter out <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> PrintWriter(socket.<span style="color:#a6e22e">getOutputStream</span>(), <span style="color:#66d9ef">true</span>);
</span></span><span style="display:flex;"><span>             BufferedReader in <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> BufferedReader(<span style="color:#66d9ef">new</span> InputStreamReader(socket.<span style="color:#a6e22e">getInputStream</span>()))) {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;Kết nối thành công đến &#34;</span> <span style="color:#f92672">+</span> host <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;:&#34;</span> <span style="color:#f92672">+</span> port);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            out.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;Hello Server từ Huy!&#34;</span>);
</span></span><span style="display:flex;"><span>            String response <span style="color:#f92672">=</span> in.<span style="color:#a6e22e">readLine</span>();
</span></span><span style="display:flex;"><span>            System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;Server trả lời: &#34;</span> <span style="color:#f92672">+</span> response);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (UnknownHostException e) {
</span></span><span style="display:flex;"><span>            System.<span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;Không tìm thấy host: &#34;</span> <span style="color:#f92672">+</span> host);
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (ConnectException e) {
</span></span><span style="display:flex;"><span>            System.<span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;Không thể kết nối đến server. Server đang tắt hoặc port sai?&#34;</span>);
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (SocketTimeoutException e) {
</span></span><span style="display:flex;"><span>            System.<span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;Timeout: Server không phản hồi kịp&#34;</span>);
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (IOException e) {
</span></span><span style="display:flex;"><span>            System.<span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;Lỗi I/O: &#34;</span> <span style="color:#f92672">+</span> e.<span style="color:#a6e22e">getMessage</span>());
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// e.printStackTrace(); // Chỉ dùng khi debug</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div>
        </div>

        <div class="post-navigation">
            
            <a class="nav-btn prev" href="https://minhhuy0211.github.io/posts/bai-viet-7/">
                <span class="nav-label">← QUAY LẠI</span>
                
            </a>
            

            
            <a class="nav-btn next" href="https://minhhuy0211.github.io/posts/bai-viet-9/">
                <span class="nav-label">TIẾP THEO →</span>
                
            </a>
            
        </div>
        </article>
</div>
    </article>
</div>

<style>
     
     
    .article-wrapper { margin-top: 120px; display: flex; justify-content: center; padding-bottom: 100px; }
    .main-article { max-width: 800px; width: 90%; padding: 0 20px; }
    .article-header { text-align: center; margin-bottom: 60px; }
    .article-meta { color: #888; font-size: 13px; letter-spacing: 2px; text-transform: uppercase; margin-bottom: 15px; }
    .article-title { font-size: 40px; font-weight: 900; line-height: 1.3; }
    .article-content { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif; font-size: 18px; line-height: 1.8; text-align: justify; }
    .article-content h2, .article-content h3 { font-family: 'Montserrat', sans-serif; font-weight: 900; margin-top: 40px; }
    .article-content pre { background: #f4f4f4; padding: 20px; border-radius: 5px; overflow-x: auto; font-size: 14px; border: 1px solid #ddd; }
    .article-content code { font-family: 'Courier New', monospace; color: #d63384; }
    .article-content img { max-width: 100%; height: auto; display: block; margin: 30px auto; }
</style>

    </main>

</body>
</html>
