<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bài 4: Hướng dẫn gửi File ảnh qua Socket trong Java - Nguyễn Trịnh Minh Huy</title>

    
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">

    
<link rel="stylesheet" href="https://minhhuy0211.github.io/css/style.css">
</head>
<body>

    
<header class="luxury-header">
    <nav class="luxury-nav">

        
        <div class="luxury-logo">
            <a href="https://minhhuy0211.github.io/">
                NGUYỄN TRỊNH MINH HUY
            </a>
        </div>

        
        <ul class="luxury-menu">
            <li>
                <a href="https://minhhuy0211.github.io/"
                   class="">
                    TRANG CHỦ
                </a>
            </li>

            <li>
                <a href="https://minhhuy0211.github.io/about/"
                   class="">
                    GIỚI THIỆU
                </a>
            </li>

            <li>
                <a href="https://minhhuy0211.github.io/posts/"
                   class="active">
                    BLOG
                </a>
            </li>

            
            <li>
                <a href="https://minhhuy0211.github.io/certificates/"
                   class="">
                    CHỨNG CHỈ
                </a>
            </li>

            <li>
                <a href="https://minhhuy0211.github.io/contact/"
                   class="">
                    LIÊN HỆ
                </a>
            </li>
        </ul>
    </nav>
</header>


    
    <main>
<div class="article-wrapper">
    <article class="main-article">
        <header class="article-header">
            <p class="article-meta">18 JANUARY 2025 — [Java Socket File Transfer Network Programming]</p>
            <h1 class="article-title">Bài 4: Hướng dẫn gửi File ảnh qua Socket trong Java</h1>
        </header>
        
        <div class="article-content">
            <p>Trong các bài trước, chúng ta đã biết cách thiết lập kết nối Socket và gửi/nhận dữ liệu text đơn giản.<br>
Nhưng khi cần gửi <strong>file nhị phân</strong> như ảnh, video, nhạc, tài liệu PDF… thì không thể dùng <code>Reader/Writer</code> (dành cho text) nữa, vì chúng sẽ làm hỏng dữ liệu binary.</p>
<p>Thay vào đó, ta phải làm việc trực tiếp với <strong>luồng byte</strong> (<code>InputStream</code> / <code>OutputStream</code>).</p>
<p>Bài hôm nay sẽ xây dựng một ứng dụng <strong>Client-Server hoàn chỉnh</strong> để gửi một file ảnh từ Client lên Server và Server lưu lại.</p>
<h3 id="1-nguyên-tắc-truyền-file-qua-socket">1. Nguyên tắc truyền file qua Socket</h3>
<ul>
<li>Client: Đọc file từ ổ cứng bằng <code>FileInputStream</code> → đẩy byte ra mạng qua <code>socket.getOutputStream()</code>.</li>
<li>Server: Nhận byte từ mạng qua <code>socket.getInputStream()</code> → ghi vào file mới bằng <code>FileOutputStream</code>.</li>
<li>Truyền theo <strong>khối (chunk)</strong> (thường 4KB - 64KB) để tránh tải toàn bộ file vào bộ nhớ.</li>
<li>Nên gửi thêm <strong>kích thước file</strong> và <strong>tên file</strong> trước để Server biết cách lưu.</li>
</ul>
<h3 id="2-code-server-nhận-file">2. Code Server (Nhận file)</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">import</span> java.io.*;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.net.*;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">FileServer</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">int</span> PORT <span style="color:#f92672">=</span> 8080;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span>(String<span style="color:#f92672">[]</span> args) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> (ServerSocket serverSocket <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ServerSocket(PORT)) {
</span></span><span style="display:flex;"><span>            System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;Server đang chạy trên port &#34;</span> <span style="color:#f92672">+</span> PORT <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;...&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">while</span> (<span style="color:#66d9ef">true</span>) {
</span></span><span style="display:flex;"><span>                Socket clientSocket <span style="color:#f92672">=</span> serverSocket.<span style="color:#a6e22e">accept</span>();
</span></span><span style="display:flex;"><span>                System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;Client kết nối: &#34;</span> <span style="color:#f92672">+</span> clientSocket.<span style="color:#a6e22e">getInetAddress</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">new</span> Thread(() <span style="color:#f92672">-&gt;</span> handleClient(clientSocket)).<span style="color:#a6e22e">start</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (IOException e) {
</span></span><span style="display:flex;"><span>            e.<span style="color:#a6e22e">printStackTrace</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">handleClient</span>(Socket socket) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> (
</span></span><span style="display:flex;"><span>            DataInputStream dis <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DataInputStream(socket.<span style="color:#a6e22e">getInputStream</span>());
</span></span><span style="display:flex;"><span>            ) {
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// 1. Nhận tên file</span>
</span></span><span style="display:flex;"><span>            String fileName <span style="color:#f92672">=</span> dis.<span style="color:#a6e22e">readUTF</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// 2. Nhận kích thước file</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">long</span> fileSize <span style="color:#f92672">=</span> dis.<span style="color:#a6e22e">readLong</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// 3. Tạo file mới để lưu</span>
</span></span><span style="display:flex;"><span>            FileOutputStream fos <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> FileOutputStream(<span style="color:#e6db74">&#34;received_&#34;</span> <span style="color:#f92672">+</span> fileName);
</span></span><span style="display:flex;"><span>            BufferedOutputStream bos <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> BufferedOutputStream(fos);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">byte</span><span style="color:#f92672">[]</span> buffer <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">byte</span><span style="color:#f92672">[</span>8192<span style="color:#f92672">]</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">int</span> bytesRead;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">long</span> totalRead <span style="color:#f92672">=</span> 0;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;Đang nhận file: &#34;</span> <span style="color:#f92672">+</span> fileName <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; (&#34;</span> <span style="color:#f92672">+</span> fileSize <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; bytes)&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// 4. Nhận và ghi dữ liệu</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">while</span> (totalRead <span style="color:#f92672">&lt;</span> fileSize <span style="color:#f92672">&amp;&amp;</span> (bytesRead <span style="color:#f92672">=</span> dis.<span style="color:#a6e22e">read</span>(buffer, 0, 
</span></span><span style="display:flex;"><span>                (<span style="color:#66d9ef">int</span>) Math.<span style="color:#a6e22e">min</span>(buffer.<span style="color:#a6e22e">length</span>, fileSize <span style="color:#f92672">-</span> totalRead))) <span style="color:#f92672">!=</span> <span style="color:#f92672">-</span>1) {
</span></span><span style="display:flex;"><span>                bos.<span style="color:#a6e22e">write</span>(buffer, 0, bytesRead);
</span></span><span style="display:flex;"><span>                totalRead <span style="color:#f92672">+=</span> bytesRead;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            bos.<span style="color:#a6e22e">flush</span>();
</span></span><span style="display:flex;"><span>            System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;Nhận file hoàn tất: &#34;</span> <span style="color:#f92672">+</span> fileName);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (IOException e) {
</span></span><span style="display:flex;"><span>            System.<span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;Lỗi khi nhận file: &#34;</span> <span style="color:#f92672">+</span> e.<span style="color:#a6e22e">getMessage</span>());
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">finally</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">try</span> { socket.<span style="color:#a6e22e">close</span>(); } <span style="color:#66d9ef">catch</span> (IOException e) {}
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div>  
        </div>
        <div class="article-content">
            <p>Trong các bài trước, chúng ta đã biết cách thiết lập kết nối Socket và gửi/nhận dữ liệu text đơn giản.<br>
Nhưng khi cần gửi <strong>file nhị phân</strong> như ảnh, video, nhạc, tài liệu PDF… thì không thể dùng <code>Reader/Writer</code> (dành cho text) nữa, vì chúng sẽ làm hỏng dữ liệu binary.</p>
<p>Thay vào đó, ta phải làm việc trực tiếp với <strong>luồng byte</strong> (<code>InputStream</code> / <code>OutputStream</code>).</p>
<p>Bài hôm nay sẽ xây dựng một ứng dụng <strong>Client-Server hoàn chỉnh</strong> để gửi một file ảnh từ Client lên Server và Server lưu lại.</p>
<h3 id="1-nguyên-tắc-truyền-file-qua-socket">1. Nguyên tắc truyền file qua Socket</h3>
<ul>
<li>Client: Đọc file từ ổ cứng bằng <code>FileInputStream</code> → đẩy byte ra mạng qua <code>socket.getOutputStream()</code>.</li>
<li>Server: Nhận byte từ mạng qua <code>socket.getInputStream()</code> → ghi vào file mới bằng <code>FileOutputStream</code>.</li>
<li>Truyền theo <strong>khối (chunk)</strong> (thường 4KB - 64KB) để tránh tải toàn bộ file vào bộ nhớ.</li>
<li>Nên gửi thêm <strong>kích thước file</strong> và <strong>tên file</strong> trước để Server biết cách lưu.</li>
</ul>
<h3 id="2-code-server-nhận-file">2. Code Server (Nhận file)</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">import</span> java.io.*;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.net.*;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">FileServer</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">int</span> PORT <span style="color:#f92672">=</span> 8080;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span>(String<span style="color:#f92672">[]</span> args) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> (ServerSocket serverSocket <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ServerSocket(PORT)) {
</span></span><span style="display:flex;"><span>            System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;Server đang chạy trên port &#34;</span> <span style="color:#f92672">+</span> PORT <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;...&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">while</span> (<span style="color:#66d9ef">true</span>) {
</span></span><span style="display:flex;"><span>                Socket clientSocket <span style="color:#f92672">=</span> serverSocket.<span style="color:#a6e22e">accept</span>();
</span></span><span style="display:flex;"><span>                System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;Client kết nối: &#34;</span> <span style="color:#f92672">+</span> clientSocket.<span style="color:#a6e22e">getInetAddress</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">new</span> Thread(() <span style="color:#f92672">-&gt;</span> handleClient(clientSocket)).<span style="color:#a6e22e">start</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (IOException e) {
</span></span><span style="display:flex;"><span>            e.<span style="color:#a6e22e">printStackTrace</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">handleClient</span>(Socket socket) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> (
</span></span><span style="display:flex;"><span>            DataInputStream dis <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DataInputStream(socket.<span style="color:#a6e22e">getInputStream</span>());
</span></span><span style="display:flex;"><span>            ) {
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// 1. Nhận tên file</span>
</span></span><span style="display:flex;"><span>            String fileName <span style="color:#f92672">=</span> dis.<span style="color:#a6e22e">readUTF</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// 2. Nhận kích thước file</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">long</span> fileSize <span style="color:#f92672">=</span> dis.<span style="color:#a6e22e">readLong</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// 3. Tạo file mới để lưu</span>
</span></span><span style="display:flex;"><span>            FileOutputStream fos <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> FileOutputStream(<span style="color:#e6db74">&#34;received_&#34;</span> <span style="color:#f92672">+</span> fileName);
</span></span><span style="display:flex;"><span>            BufferedOutputStream bos <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> BufferedOutputStream(fos);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">byte</span><span style="color:#f92672">[]</span> buffer <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">byte</span><span style="color:#f92672">[</span>8192<span style="color:#f92672">]</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">int</span> bytesRead;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">long</span> totalRead <span style="color:#f92672">=</span> 0;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;Đang nhận file: &#34;</span> <span style="color:#f92672">+</span> fileName <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; (&#34;</span> <span style="color:#f92672">+</span> fileSize <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; bytes)&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// 4. Nhận và ghi dữ liệu</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">while</span> (totalRead <span style="color:#f92672">&lt;</span> fileSize <span style="color:#f92672">&amp;&amp;</span> (bytesRead <span style="color:#f92672">=</span> dis.<span style="color:#a6e22e">read</span>(buffer, 0, 
</span></span><span style="display:flex;"><span>                (<span style="color:#66d9ef">int</span>) Math.<span style="color:#a6e22e">min</span>(buffer.<span style="color:#a6e22e">length</span>, fileSize <span style="color:#f92672">-</span> totalRead))) <span style="color:#f92672">!=</span> <span style="color:#f92672">-</span>1) {
</span></span><span style="display:flex;"><span>                bos.<span style="color:#a6e22e">write</span>(buffer, 0, bytesRead);
</span></span><span style="display:flex;"><span>                totalRead <span style="color:#f92672">+=</span> bytesRead;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            bos.<span style="color:#a6e22e">flush</span>();
</span></span><span style="display:flex;"><span>            System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;Nhận file hoàn tất: &#34;</span> <span style="color:#f92672">+</span> fileName);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (IOException e) {
</span></span><span style="display:flex;"><span>            System.<span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;Lỗi khi nhận file: &#34;</span> <span style="color:#f92672">+</span> e.<span style="color:#a6e22e">getMessage</span>());
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">finally</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">try</span> { socket.<span style="color:#a6e22e">close</span>(); } <span style="color:#66d9ef">catch</span> (IOException e) {}
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div>
        </div>

        <div class="post-navigation">
            
            <a class="nav-btn prev" href="https://minhhuy0211.github.io/posts/bai-viet-3/">
                <span class="nav-label">← QUAY LẠI</span>
                
            </a>
            

            
            <a class="nav-btn next" href="https://minhhuy0211.github.io/posts/bai-viet-5/">
                <span class="nav-label">TIẾP THEO →</span>
                
            </a>
            
        </div>
        </article>
</div>
    </article>
</div>

<style>
     
     
    .article-wrapper { margin-top: 120px; display: flex; justify-content: center; padding-bottom: 100px; }
    .main-article { max-width: 800px; width: 90%; padding: 0 20px; }
    .article-header { text-align: center; margin-bottom: 60px; }
    .article-meta { color: #888; font-size: 13px; letter-spacing: 2px; text-transform: uppercase; margin-bottom: 15px; }
    .article-title { font-size: 40px; font-weight: 900; line-height: 1.3; }
    .article-content { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif; font-size: 18px; line-height: 1.8; text-align: justify; }
    .article-content h2, .article-content h3 { font-family: 'Montserrat', sans-serif; font-weight: 900; margin-top: 40px; }
    .article-content pre { background: #f4f4f4; padding: 20px; border-radius: 5px; overflow-x: auto; font-size: 14px; border: 1px solid #ddd; }
    .article-content code { font-family: 'Courier New', monospace; color: #d63384; }
    .article-content img { max-width: 100%; height: auto; display: block; margin: 30px auto; }
</style>

    </main>

</body>
</html>
